{% extends 'base.html' %}
{% load static %}


{% block content %}
<div class="title purple darken-1">
	<h1 class="center-align">Speedtest</h1>
</div>	
<div class="container" id="speedtest-content">
	<div class="row">
		<div class="col s12 m6 input-field">
			<select>
				<option value="" disabled selected>Choose your option</option>
				{% for item in objects %}
				<option value={{item.server}}>{{item.name}}</option>
				{% endfor %}
			</select>
			<label>Pilih Server</label>
		</div>
		<div class="col s12 m6 center-align">
			<button id="speedtest" class="btn waves-effect waves-light purple lighten-1" type="submit" name="action">Submit
				<i class="material-icons right">send</i>
			</button>
		</div>
		<div class="col s12"></div>
		<div class="col s12 center-align loading"><img src="{% static '/images/loading.svg' %}"></div>
		<div class="row" id="speedresult">
			<div class="col s12 m3">
				<div class="card-panel purple lighten-3">
					<h5 class="center-align">Download :</h5>
					<p id="download" class="center-align"></p>
				</div>
			</div>
			<div class="col s12 m3">
				<div class="card-panel purple lighten-3">
					<h5 class="center-align">Upload :</h5>
					<p id="upload" class="center-align"></p>
				</div>
			</div>
			<div class="col s12 m3">
				<div class="card-panel purple lighten-3">
					<h5 class="center-align">Ping :</h5>
					<p id="ping" class="center-align"></p>
				</div>
			</div>
			<div class="col s12 m3">
				<div class="card-panel purple lighten-3">
					<h5 class="center-align">ISP :</h5>
					<p id="isp" class="center-align"></p>
				</div>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">
	$(function(){
		$('select').formSelect();
		$('#speedresult').hide()
		$('.loading').hide()
		$('#speedtest').click(function(){
			var server_id = $('select').val();
			$('#speedtest').prop('disabled', true);
			$('#speedresult').hide()
			$('.loading').show();
			$.ajax({
				url:'/speedtest/speed_count',
				data:{'server': server_id},
				dataType:'json',
				success: function (data){
					console.log(data)
					$('#speedtest').prop('disabled', false);
					$('.loading').hide();
					$('#speedresult').show();
					$('#download').text(data.download+'Mbps');
					$('#upload').text(data.upload+'Mbps');
					$('#ping').text(data.ping+'Ms');
					$('#isp').text(data.isp);
				}
			});
		});
	});
	
	
</script>

{% endblock %}